<div id="business-month-area">
  <app-page-header [title]="'业务月报'"></app-page-header>
  <div class="h-100 position-relative">
    <div class="row head-search-container">
      <div class="col-2 container-input">
        <dl>
          <dt><span style="color: red">*&nbsp;</span>查询月:</dt>
          <dd>
            <ng2-flatpickr [config]="searchMonthOptions"></ng2-flatpickr>
          </dd>
        </dl>
      </div>
      <div class="col-2 container-input">
        <dl>
          <dt>业务:</dt>
          <dd>
            <mat-form-field class="right-input" [floatPlaceholder]="'never'">
              <mat-select [(ngModel)]="params.serviceId" placeholder="请选择">
                <mat-option  [value]="''">全部</mat-option>
                <mat-option *ngFor="let item of businessIdArr" [value]="item.id">
                  {{item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </dd>
        </dl>
      </div>
      <div class="col-2 container-input">
        <dl>
          <dt>产品:</dt>
          <dd>
            <mat-form-field class="right-input" [floatPlaceholder]="'never'">
              <mat-select [(ngModel)]="params.productId" placeholder="请选择">
                <mat-option  [value]="''">全部</mat-option>
                <mat-option *ngFor="let item of productIdArr" [value]="item.id">
                  {{item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </dd>
        </dl>
      </div>
      <div class="col-2 container-input">
        <dl>
          <dt>平台:</dt>
          <dd>
            <mat-form-field class="right-input" [floatPlaceholder]="'never'">
              <mat-select [(ngModel)]="params.domainId" placeholder="请选择">
                <mat-option  [value]="''">全部</mat-option>
                <mat-option *ngFor="let item of domainIdArr" [value]="item.id">
                  {{item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </dd>
        </dl>
      </div>
      <div class="col-2 container-input">
        <dl>
          <dt>实例:</dt>
          <dd>
            <mat-form-field class="right-input" [floatPlaceholder]="'never'">
              <mat-select [(ngModel)]="params.opensipsId" placeholder="请选择">
                <mat-option  [value]="''">全部</mat-option>
                <mat-option *ngFor="let item of opensipsIdArr" [value]="item.id">
                  {{item.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </dd>
        </dl>
      </div>
      <div class="col-2 container-input">
        <button mat-button class="search-button" (click)="search()">搜索</button>
      </div>
    </div>
    <div *ngIf="isPermission === 1" class="table-container">
      <ngx-datatable class="material striped"
                     [loadingIndicator]="loadingIndicator"
                     [rows]="monthBusinessData"
                     [headerHeight]="40"
                     [footerHeight]="40"
                     [rowHeight]="40"
                     [scrollbarH]="true"
                     [columnMode]="'force'"
                     [limit]="params.pageSize">
        <ngx-datatable-column name="产品ID" prop="productId"></ngx-datatable-column>
        <ngx-datatable-column name="平台ID" prop="domainId" [width]="200"></ngx-datatable-column>
        <ngx-datatable-column name="业务ID" prop="serviceId" [width]="200"></ngx-datatable-column>
        <ngx-datatable-column name="OpensipsIP" prop="opensipsIp" [width]="200"></ngx-datatable-column>
        <ngx-datatable-column name="月份" prop="month" [width]="200"></ngx-datatable-column>
        <ngx-datatable-column name="总数" prop="totalCount"></ngx-datatable-column>
        <ngx-datatable-column name="成功路由个数" prop="successRouteCount"></ngx-datatable-column>
        <ngx-datatable-column name="被限制数" prop="limitCount"></ngx-datatable-column>
        <ngx-datatable-column name="由于acl被拒绝数" prop="aclCount"></ngx-datatable-column>
        <ngx-datatable-column name="路由失败个数" prop="routeFailCount"></ngx-datatable-column>
        <ngx-datatable-column name="应答个数" prop="answerCount"></ngx-datatable-column>
        <ngx-datatable-column name="通话分钟数">
          <ng-template let-row="row" ngx-datatable-cell-template>{{row?.answerDuration | minuteFormat}}</ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [name]="'创建时间'" [width]="200">
          <ng-template let-row="row" ngx-datatable-cell-template>{{row?.createTime | dateFormat:'YYYY-MM-DD HH:mm:ss'}}</ng-template>
        </ngx-datatable-column>
        <ngx-datatable-footer>
          <ng-template ngx-datatable-footer-template>
            <app-pagination [pageParams]="params" [comTotalCount]="totalCount"
                            (limitChange)="getLimit($event)"
                            (pageParamsChange)="reloadDayBusinessCount($event)"></app-pagination>
            <div class="report-summary">
              总数:{{summaryData?.totalCount}}；
              成功总数:{{summaryData?.successRouteCount}}；
              被限制数:{{summaryData?.limitCount}}；
              由于acl被拒绝数:{{summaryData?.aclCount}}；
              路由失败个数:{{summaryData?.routeFailCount}}；
              应答个数:{{summaryData?.answerCount}}；
              通话分钟数:{{summaryData?.answerDuration}}。
            </div>
          </ng-template>
        </ngx-datatable-footer>
      </ngx-datatable>
    </div>
    <app-empty-data *ngIf="isPermission === 0"></app-empty-data>
    <app-loading *ngIf="isSpinner === 1" [top]="'258px'"></app-loading>
  </div>
</div>


