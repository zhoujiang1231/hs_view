<div id="system-customerManage-area">
    <app-page-header [title]="'企业管理'"
                     [rightButtons]="[{ title: '新建', action: 'add'}]"
                     (tapRightBtn)="onClickBtnWithAction($event)"
                     [permission]="isPermission"></app-page-header>
    <div class="h-100 position-relative">
        <div class="row head-search-container">
            <div class="col-2 container-input">
                <dl>
                    <dt>企业名称:</dt>
                    <dd>
                        <mat-form-field class="right-input" [floatPlaceholder]="'never'">
                            <input matInput placeholder="请输入" [(ngModel)]="params.fullName">
                        </mat-form-field>
                    </dd>
                </dl>
            </div>
            <div class="col-2 container-input">
                <dl>
                    <dt>所属部门:</dt>
                    <dd>
                        <mat-form-field class="right-input" [floatPlaceholder]="'never'">
                            <mat-select [(ngModel)]="params.parentParentId" placeholder="请选择"
                                        (change)="getdirectMangerData()">
                                <mat-option *ngFor="let item of directDepartmentData" [value]="item?.id">
                                    {{item?.fullName}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </dd>
                </dl>
            </div>
            <div class="container-input" style="width: 11%">
                <dl>
                    <dt>所属经理:</dt>
                    <dd>
                        <mat-form-field class="right-input" [floatPlaceholder]="'never'">
                            <mat-select [(ngModel)]="params.parentId" placeholder="请选择">
                                <mat-option *ngFor="let item of directMangerData" [value]="item?.id">
                                    {{item?.fullName}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </dd>
                </dl>
            </div>
            <div class="container-input"  style="width: 11%">
                <dl>
                    <dt>余额:</dt>
                    <dd>
                        <mat-form-field class="right-input" [floatPlaceholder]="'never'">
                            <mat-select [(ngModel)]="params.balanceType" placeholder="请选择">
                                <mat-option
                                        *ngFor="let item of [{name:'全部',value:''},{name:'正常',value:'normal'},{name:'欠费',value:'overdue'}]"
                                        [value]="item?.value">
                                    {{item?.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </dd>
                </dl>
            </div>
            <div class="container-input"  style="width: 11%">
                <dl>
                    <dt>状态:</dt>
                    <dd>
                        <mat-form-field class="right-input" [floatPlaceholder]="'never'">
                            <mat-select [(ngModel)]="params.status" placeholder="请选择">
                                <mat-option
                                        *ngFor="let item of [{name:'全部',value:''},{name:'暂停',value:'2'},{name:'注销',value:'4'},{name:'上线',value:'5'},{name:'测试',value:'6'}]"
                                        [value]="item?.value">
                                    {{item?.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </dd>
                </dl>
            </div>
            <div class="col-2 container-input">
                <dl>
                    <dt>营业执照:</dt>
                    <dd>
                        <mat-form-field class="right-input" [floatPlaceholder]="'never'">
                            <mat-select [(ngModel)]="params.businessUpFlag" placeholder="请选择">
                                <mat-option
                                        *ngFor="let item of [{name:'全部',value:''},{name:'未上传',value:'0'},{name:'已上传',value:'1'}]"
                                        [value]="item?.value">
                                    {{item?.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </dd>
                </dl>
            </div>
            <div class="col-1">
                <button mat-button class="search-button" (click)="search()">搜索</button>
            </div>
            <div *ngIf="isPermission == 1" class="col-1">
                <button mat-button class="search-button" (click)="export()">导出</button>
            </div>
        </div>
        <div *ngIf="isPermission === 1" class="table-container w-100">
            <ngx-datatable class="material striped"
                           [rows]="sysCustomerData"
                           [headerHeight]="40"
                           [footerHeight]="40"
                           [rowHeight]="40"
                           [columnMode]="'force'"
                           [scrollbarH]="true"
                           [limit]="params.limit">
                <ngx-datatable-column [name]="'企业名称'" [prop]="'fullName'">
                    <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                        <span class="linkSpan" (click)="customerInfo(row)">{{value}}</span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column [name]="'简称'" [prop]="'shortName'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'所属部门'" [prop]="'parentParentName'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'所属经理'" [prop]="'parentName'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'余额'" [prop]="'currentMoney'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'应用数量'" [prop]="'appCount'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'状态'" [prop]="'customerStatusDec'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'营业执照'" [prop]="'businessUpFlagDec'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'上线时间'" [prop]="'uptime'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'企业低消	'" [prop]="'minCost'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'应用低消总和'" [prop]="'currentMinCost'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'创建时间'" [prop]="'createTime'"></ngx-datatable-column>
                <ngx-datatable-column [name]="'操作'">
                    <ng-template let-row="row" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <span class="linkSpan" (click)="operateButton(row)">删除</span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-footer>
                    <ng-template ngx-datatable-footer-template>
                        <app-pagination [pageParams]="params" [comTotalCount]="totalCount"
                                        (limitChange)="getLimit($event)"
                                        (pageParamsChange)="reloadCustomerData($event)"></app-pagination>
                    </ng-template>
                </ngx-datatable-footer>
            </ngx-datatable>
            <iframe [src]="downiframe" width="0" height="0" style="display: none;"></iframe>
        </div>
        <app-loading *ngIf="isSpinner === 1" [top]="'258px'"></app-loading>
        <app-empty-data *ngIf="isPermission === 0"></app-empty-data>
    </div>
</div>
